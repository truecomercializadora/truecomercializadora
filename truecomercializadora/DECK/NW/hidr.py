from DECK.utils import UTILS
from datetime import datetime

class hidr_block(UTILS):
    def __init__(self):
        self.cabecalho = ""
        self.size = 792
        self.campos = [(0, 0, 'I3*', 'Cod'),
        (1, 12, 'A12', 'Usina'),
        (25, 28, 'I4', 'Sistema'),
        (29, 32, 'I4', 'Empresa'),
        (13, 16, 'I4', 'Posto'),
        (17, 24, 'A8', 'Posto BDH'),
        (33, 36, 'I4', 'Jusante'),
        (37, 40, 'I4', 'Desvio'),
        (45, 48, 'F4', 'Vol.Máx.(hm3)'),
        (41, 44, 'F4', 'Vol.min.(hm3)'),
        (61, 64, 'F4', 'Cota Máx.(m)'),
        (57, 60, 'F4', 'Cota min.(m)'),
        (49, 52, 'F4', 'Vol.Vert.(hm3)'),
        (53, 56, 'F4', 'Vol.Desv.(hm3)'),
        (65, 68, 'F4', 'PCV(0)'),
        (69, 72, 'F4', 'PCV(1)'),
        (73, 76, 'F4', 'PCV(2)'),
        (77, 80, 'F4', 'PCV(3)'),
        (81, 84, 'F4', 'PCV(4)'),
        (85, 88, 'F4', 'PAC(0)'),
        (89, 92, 'F4', 'PAC(1)'),
        (93, 96, 'F4', 'PAC(2)'),
        (97, 100, 'F4', 'PAC(3)'),
        (101, 104, 'F4', 'PAC(4)'),
        (105, 108, 'I4', 'Evap.Men.(1)'),
        (109, 112, 'I4', 'Evap.Men.(2)'),
        (113, 116, 'I4', 'Evap.Men.(3)'),
        (117, 120, 'I4', 'Evap.Men.(4)'),
        (121, 124, 'I4', 'Evap.Men.(5)'),
        (125, 128, 'I4', 'Evap.Men.(6)'),
        (129, 132, 'I4', 'Evap.Men.(7)'),
        (133, 136, 'I4', 'Evap.Men.(8)'),
        (137, 140, 'I4', 'Evap.Men.(9)'),
        (141, 144, 'I4', 'Evap.Men.(10)'),
        (145, 148, 'I4', 'Evap.Men.(11)'),
        (149, 152, 'I4', 'Evap.Men.(12)'),
        (537, 540, 'F4', 'Prod.Esp.(MW/m3/s/m)'),
        (693, 696, 'F4', 'Canal Fuga Médio(m)'),
        (725, 728, 'F4', 'TEIF(%)'),
        (729, 732, 'F4', 'IP(%)'),
        (717, 720, 'I4', 'Tipo Turbina'),
        (153, 156, 'I4', 'Num.Conj.Máq.'),
        (545, 548, 'I4', 'Num.Pols.Jus.'),
        (701, 704, 'F4', 'Fat.Carga Máx.(%)'),
        (705, 708, 'F4', 'Fat.Carga mín.(%)'),
        (733, 736, 'I4', 'Tipo Perdas(1=%/2=M/3=K)'),
        (541, 544, 'F4', 'Valor Perdas'),
        (709, 712, 'I4', 'Vazão Mín.Hist.(m3/s)'),
        (713, 716, 'I4', 'Num.Unid.Base'),
        (697, 700, 'I4', 'Infl.Vert.Canal de Fuga'),
        (721, 724, 'I4', 'Rep.Conj(0=aprox/1=det/2=simp)'),
        (157, 160, 'I4', '#Maq(1)'),
        (177, 180, 'F4', 'PotEf(1)'),
        (517, 520, 'I4', 'QEf(1)'),
        (497, 500, 'F4', 'HEf(1)'),
        (161, 164, 'I4', '#Maq(2)'),
        (181, 184, 'F4', 'PotEf(2)'),
        (521, 524, 'I4', 'QEf(2)'),
        (501, 504, 'F4', 'HEf(2)'),
        (165, 168, 'I4', '#Maq(3)'),
        (185, 188, 'F4', 'PotEf(3)'),
        (525, 528, 'I4', 'QEf(3)'),
        (505, 508, 'F4', 'HEf(3)'),
        (169, 172, 'I4', '#Maq(4)'),
        (189, 192, 'F4', 'PotEf(4)'),
        (529, 532, 'I4', 'QEf(4)'),
        (509, 512, 'F4', 'HEf(4)'),
        (173, 176, 'I4', '#Maq(5)'),
        (193, 196, 'F4', 'PotEf(5)'),
        (533, 536, 'I4', 'QEf(5)'),
        (513, 516, 'F4', 'HEf(5)'),
        (197, 200, 'F4', 'QHTA0(1)'),
        (201, 204, 'F4', 'QHTA1(1)'),
        (205, 208, 'F4', 'QHTA2(1)'),
        (209, 212, 'F4', 'QHTA3(1)'),
        (213, 216, 'F4', 'QHTA4(1)'),
        (217, 220, 'F4', 'QHTA0(2)'),
        (221, 224, 'F4', 'QHTA1(2)'),
        (225, 228, 'F4', 'QHTA2(2)'),
        (229, 232, 'F4', 'QHTA3(2)'),
        (233, 236, 'F4', 'QHTA4(2)'),
        (237, 240, 'F4', 'QHTA0(3)'),
        (241, 244, 'F4', 'QHTA1(3)'),
        (245, 248, 'F4', 'QHTA2(3)'),
        (249, 252, 'F4', 'QHTA3(3)'),
        (253, 256, 'F4', 'QHTA4(3)'),
        (257, 260, 'F4', 'QHTA0(4)'),
        (261, 264, 'F4', 'QHTA1(4)'),
        (265, 268, 'F4', 'QHTA2(4)'),
        (269, 272, 'F4', 'QHTA3(4)'),
        (273, 276, 'F4', 'QHTA4(4)'),
        (277, 280, 'F4', 'QHTA0(5)'),
        (281, 284, 'F4', 'QHTA1(5)'),
        (285, 288, 'F4', 'QHTA2(5)'),
        (289, 292, 'F4', 'QHTA3(5)'),
        (293, 296, 'F4', 'QHTA4(5)'),
        (297, 300, 'F4', 'QHGA0(1)'),
        (301, 304, 'F4', 'QHGA1(1)'),
        (305, 308, 'F4', 'QHGA2(1)'),
        (309, 312, 'F4', 'QHGA3(1)'),
        (313, 316, 'F4', 'QHGA4(1)'),
        (317, 320, 'F4', 'QHGA0(2)'),
        (321, 324, 'F4', 'QHGA1(2)'),
        (325, 328, 'F4', 'QHGA2(2)'),
        (329, 332, 'F4', 'QHGA3(2)'),
        (333, 336, 'F4', 'QHGA4(2)'),
        (337, 340, 'F4', 'QHGA0(3)'),
        (341, 344, 'F4', 'QHGA1(3)'),
        (345, 348, 'F4', 'QHGA2(3)'),
        (349, 352, 'F4', 'QHGA3(3)'),
        (353, 356, 'F4', 'QHGA4(3)'),
        (357, 360, 'F4', 'QHGA0(4)'),
        (361, 364, 'F4', 'QHGA1(4)'),
        (365, 368, 'F4', 'QHGA2(4)'),
        (369, 372, 'F4', 'QHGA3(4)'),
        (373, 376, 'F4', 'QHGA4(4)'),
        (377, 380, 'F4', 'QHGA0(5)'),
        (381, 384, 'F4', 'QHGA1(5)'),
        (385, 388, 'F4', 'QHGA2(5)'),
        (389, 392, 'F4', 'QHGA3(5)'),
        (393, 396, 'F4', 'QHGA4(5)'),
        (397, 400, 'F4', 'PHA0(1)'),
        (401, 404, 'F4', 'PHA1(1)'),
        (405, 408, 'F4', 'PHA2(1)'),
        (409, 412, 'F4', 'PHA3(1)'),
        (413, 416, 'F4', 'PHA4(1)'),
        (417, 420, 'F4', 'PHA0(2)'),
        (421, 424, 'F4', 'PHA1(2)'),
        (425, 428, 'F4', 'PHA2(2)'),
        (429, 432, 'F4', 'PHA3(2)'),
        (433, 436, 'F4', 'PHA4(2)'),
        (437, 440, 'F4', 'PHA0(3)'),
        (441, 444, 'F4', 'PHA1(3)'),
        (445, 448, 'F4', 'PHA2(3)'),
        (449, 452, 'F4', 'PHA3(3)'),
        (453, 456, 'F4', 'PHA4(3)'),
        (457, 460, 'F4', 'PHA0(4)'),
        (461, 464, 'F4', 'PHA1(4)'),
        (465, 468, 'F4', 'PHA2(4)'),
        (469, 472, 'F4', 'PHA3(4)'),
        (473, 476, 'F4', 'PHA4(4)'),
        (493, 496, 'F4', 'PHA4(4)'),
        (477, 480, 'F4', 'PHA0(5)'),
        (481, 484, 'F4', 'PHA1(5)'),
        (485, 488, 'F4', 'PHA2(5)'),
        (489, 492, 'F4', 'PHA3(5)'),
        (549, 552, 'F4', 'PJA0(1)'),
        (553, 556, 'F4', 'PJA1(1)'),
        (557, 560, 'F4', 'PJA2(1)'),
        (561, 564, 'F4', 'PJA3(1)'),
        (565, 568, 'F4', 'PJA4(1)'),
        (669, 672, 'F4', 'PJRM(1)'),
        (569, 572, 'F4', 'PJA0(2)'),
        (573, 576, 'F4', 'PJA1(2)'),
        (577, 580, 'F4', 'PJA2(2)'),
        (581, 584, 'F4', 'PJA3(2)'),
        (585, 588, 'F4', 'PJA4(2)'),
        (673, 676, 'F4', 'PJRM(2)'),
        (589, 592, 'F4', 'PJA0(3)'),
        (593, 596, 'F4', 'PJA1(3)'),
        (597, 600, 'F4', 'PJA2(3)'),
        (601, 604, 'F4', 'PJA3(3)'),
        (605, 608, 'F4', 'PJA4(3)'),
        (677, 680, 'F4', 'PJRM(3)'),
        (609, 612, 'F4', 'PJA0(4)'),
        (613, 616, 'F4', 'PJA1(4)'),
        (617, 620, 'F4', 'PJA2(4)'),
        (621, 624, 'F4', 'PJA3(4)'),
        (625, 628, 'F4', 'PJA4(4)'),
        (681, 684, 'F4', 'PJRM(4)'),
        (629, 632, 'F4', 'PJA0(5)'),
        (633, 636, 'F4', 'PJA1(5)'),
        (637, 640, 'F4', 'PJA2(5)'),
        (641, 644, 'F4', 'PJA3(5)'),
        (645, 648, 'F4', 'PJA4(5)'),
        (685, 688, 'F4', 'PJRM(5)'),
        (737, 744, 'A8', 'Data'),
        (745, 787, 'A43', 'Obs'),
        (788, 791, 'F4', 'Vol.Ref.'),
        (792, 792, 'A1', 'Reg')]
        self.valores = []

class HIDR(UTILS):
    def __init__(self,caminho):
        self.blocos = {'hidr':hidr_block()}
        self.caminho = caminho
        self.hidr = self.blocos['hidr']
        self.nome = "HIDR"
        self.ERROS = []
        self.load()
        self.hash = super().gerarHash()


    def load(self):
        if type(self.caminho)==bytes:
            dados = self.caminho
        else:
            with open(self.caminho, 'rb') as f:
                dados = f.read()
        reg_num  = len(dados) // self.hidr.size
        cod = 1
        for i in range(reg_num):
            reg_bytes = dados[self.hidr.size * i : self.hidr.size * (i + 1)]
            valores = super()._interpretarLinhaBinaria(self.hidr.campos, reg_bytes)
            valores['Cod'] = cod
            self.hidr.valores.append(valores)
            cod+=1
    def save(self):
        return super()._saveToFileBytes(self.blocos.values())
    